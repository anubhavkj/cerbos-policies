apiVersion: api.cerbos.dev/v1
resourcePolicy:
  version: default
  resource: vendor_contract

  importDerivedRoles:
    - role_hierarchy_scoped

  rules:
    - actions: ["vendor_contract_access"]
      derivedRoles: ["scm_role", "admin_role"]
      effect: EFFECT_ALLOW

    - actions: ["vendor_contract_access"]
      roles: ["*"]
      effect: EFFECT_DENY
      condition:
        match:
          expr: request.resource.attr.expiresAt != null
                && request.resource.attr.now != null
                && timestamp(request.resource.attr.expiresAt)
                   < timestamp(request.resource.attr.now)

